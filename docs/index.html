<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Mini GeoGuessr-like — 20候補版</title>

  <!-- Leaflet (推測用マップ) -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
        integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin=""/>
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
          integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin=""></script>

  <!-- Photo Sphere Viewer (APIキー不要の 360° ビューア) -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/photo-sphere-viewer@4.2.0/dist/photo-sphere-viewer.min.css">
  <script src="https://cdn.jsdelivr.net/npm/uevent@2.0.0/browser.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/three@0.137.5/build/three.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/photo-sphere-viewer@4.2.0/dist/photo-sphere-viewer.min.js"></script>

  <script>
    try {
      window.GOOGLE_MAPS_API_KEY = localStorage.getItem('gsv_api_key') || '';
    } catch (err) {
      window.GOOGLE_MAPS_API_KEY = '';
    }
  </script>
  <link rel="stylesheet" href="style.css" />
</head>
<body>
  <header>
    <div class="brand-area">
      <div class="brand">🌍 Mini GeoGuessr-like</div>
      <nav class="nav-links" aria-label="サブページ">
        <a class="nav-link" href="quiz.html">GeoGuessr Wiki クイズ</a>
        <a class="nav-link" href="flag-quiz.html">国旗クイズ</a>
      </nav>
    </div>
    <div class="score">
      <div>ラウンド: <b id="roundLabel">0 / 3</b></div>
      <div>スコア: <b id="scoreLabel">0</b></div>
      <div>候補: <b id="poolLabel">0 / 20</b></div>
    </div>
    <div class="prefs">
      <div class="pref-group">
        ラウンド数:
        <input id="roundsInput" type="number" min="1" max="20" value="3" disabled />
        <button id="startBtn" class="btn">ゲーム開始</button>
      </div>
      <div class="pref-group api-key-group">
        Google APIキー (任意):
        <input id="apiKeyInput" type="password" placeholder="Google Maps API Key" autocomplete="off" />
        <button id="apiKeySave" class="btn secondary small">保存</button>
        <button id="apiKeyClear" class="btn warn small">クリア</button>
      </div>
    </div>
  </header>

  <div class="layout">
    <div style="position: relative;">
      <div id="pano"></div>
      <div class="panel">360°ビュー：ドラッグで見回す／スクロールでズーム</div>
      <div class="controls">
        <button id="guessBtn" class="btn success" disabled>この場所にする！</button>
        <button id="nextBtn"  class="btn secondary" disabled>次のラウンド ▶</button>
        <button id="resetBtn" class="btn warn">リスタート</button>
      </div>

      <!-- 結果 -->
      <div class="overlay" id="resultOverlay" aria-hidden="true">
        <div class="card">
          <h3 id="resultTitle">結果</h3>
          <div class="metric" style="margin: 8px 0 12px;">
            <div class="pill">距離 <span id="distLabel">—</span></div>
            <div class="pill">獲得 <span id="pointsLabel">—</span> pt</div>
          </div>
          <div style="color: var(--sub); margin-bottom: 8px;">
            正解：<b id="answerLabel">—</b><br/>
            <small id="creditLabel" style="color: var(--sub);"></small>
          </div>
          <button id="closeResult" class="btn">閉じる</button>
          <div class="footer-note">※ 線：推測地点→実際の地点</div>
        </div>
      </div>

      <!-- ローディング -->
      <div class="overlay" id="loadingOverlay" aria-hidden="true">
        <div class="card">
          <h3 id="loadingTitle">候補を準備中…</h3>
          <div class="loadingbar" style="margin: 8px 0 10px;"><div id="loadingBar"></div></div>
          <div id="loadingText" style="color: var(--sub);">準備中</div>
          <div id="loadingNote" style="margin-top:10px; color: var(--sub); font-size: 12px;">
            ※ APIキーなしで遊べるサンプル画像セットを使用します
          </div>
        </div>
      </div>
    </div>

    <div id="map"></div>
  </div>

  <script src="app.js"></script>
</body>
</html>
